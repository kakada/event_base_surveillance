#content
  %nav.navbar.navbar-expand-lg.navbar-light.bg-light
    .container-fluid
      %h3= t('event.event')
      - if policy(Event).create?
        = link_to new_event_path, class: 'btn btn-primary' do
          %i.fas.fa-plus

  = render partial: "shared/no_data", locals: { items: @events }

  - if @events.present?
    %table.table.table-hover.medium-width
      %thead
        %tr
          %th= t('event.event_type')
          %th= t('event.location')
          %th= t('event.number_of_case')
          %th= t('event.status')
          %th= t('event.risk_level')
          %th= t('event.open_case_date')
          %th= t('event.owner')
          %th
      %tbody
        - @events.each do |event|
          %tr
            %td
              .flex-row-vertical-center
                .small-color{style: "background-color: #{event.event_type_color}"}
                  = event.event_type_name[0]
                %span
                  = link_to event.event_type_name, event_path(event), class: 'btn btn-link'
            %td= event.location_name
            %td= event.field_values.select{|fv| fv.field_code == 'number_of_case'}.first.try(:value)
            %td
              - if value = event.field_values.select{|fv| fv.field_code == 'status'}.first.try(:value).presence
                %span.badge{class: (event.close? ? 'badge-success' : 'badge-warning') }= value
              - else
                %span.badge= '-'

            %td
              - risk_level = event.field_values.select{|fv| fv.field_code == 'risk_level'}.first
              - style = risk_level.present? ? "background-color: #{risk_level.color}; color: #fff" : ''
              %span.badge{style: style}
                = risk_level.try(:value) || '-'
            %td= l(event.created_at, format: :long)
            %td= event.program_name
            %td
              - if policy(event).update?
                = link_to t('shared.edit'), edit_event_path(event), class: 'badge badge-info'

  - if @pagy.pages > 1
    .pagy-wrapper
      != pagy_bootstrap_nav(@pagy)
